<IfModule mod_setenvif.c>
	<IfModule mod_headers.c>
		BrowserMatch MSIE ie
		Header set X-UA-Compatible "IE=Edge,chrome=1" env=ie
	</IfModule>
</IfModule>

<IfModule mod_headers.c>
	Header append Vary User-Agent
</IfModule>

FileETag All

<FilesMatch "\.(ttf|otf|eot|woff|font.css)$">
	<IfModule mod_headers.c>
		Header set Access-Control-Allow-Origin "*"
	</IfModule>
</FilesMatch>

# Protect files and directories from prying eyes.
<FilesMatch "(\.(tpl(\.php)?|xtmpl)|code-style\.pl|Entries.*|Repository|Root|Tag|Template)$">
  Order allow,deny
</FilesMatch>

# audio
AddType audio/ogg						oga ogg

# video
AddType video/ogg						ogv
AddType video/mp4						mp4
AddType video/webm						webm

# Proper svg serving. Required for svg webfonts on iPad
AddType		image/svg+xml				svg svgz 
AddEncoding gzip						svgz

# webfonts
AddType application/vnd.ms-fontobject	eot
AddType font/truetype					ttf
AddType font/opentype					otf
AddType application/x-font-woff			woff

# assorted types
AddType image/x-icon					ico
AddType image/webp						webp
AddType text/x-component				htc

<IfModule mod_deflate.c>
	# force deflate for mangled headers developer.yahoo.com/blogs/ydn/posts/2010/12/pushing-beyond-gzipping/
	<IfModule mod_setenvif.c>
		<IfModule mod_headers.c>
			SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s,?\s(gzip|deflate)?|X{4,13}|~{4,13}|-{4,13})$ HAVE_Accept-Encoding
			RequestHeader append Accept-Encoding "gzip,deflate" env=HAVE_Accept-Encoding
		</IfModule>
	</IfModule>
	# html, txt, css, js, json, xml, htc:
	<IfModule filter_module>
		<IfVersion >= 2.4>
			FilterDeclare   COMPRESS
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'text/html'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'text/css'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'text/plain'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'text/xml'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'text/x-component'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/javascript'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/json'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/xml'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/xhtml+xml'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/rss+xml'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/atom+xml'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/vnd.ms-fontobject'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'image/svg+xml'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'image/x-icon'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'application/x-font-ttf'"
			FilterProvider  COMPRESS  DEFLATE "%{CONTENT_TYPE} = 'font/opentype'"
			FilterChain     COMPRESS
			FilterProtocol  COMPRESS  DEFLATE change=yes;byteranges=no
		</IfVersion>
		<IfVersion <= 2.2>
			FilterDeclare   COMPRESS
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $text/html
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $text/css
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $text/plain
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $text/xml
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $text/x-component
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/javascript
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/json
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/xml
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/xhtml+xml
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/rss+xml
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/atom+xml
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/vnd.ms-fontobject
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $image/svg+xml
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $image/x-icon
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $application/x-font-ttf
			FilterProvider  COMPRESS  DEFLATE resp=Content-Type $font/opentype
			FilterChain     COMPRESS
			FilterProtocol  COMPRESS  DEFLATE change=yes;byteranges=no
		</IfVersion>
	</IfModule>

# webfonts and svg:
	<FilesMatch "\.(ttf|otf|eot|svg)$" >
		SetOutputFilter DEFLATE
	</FilesMatch>
</IfModule>



# Don't show directory listings for URLs which map to a directory.
Options -Indexes

# Follow symbolic links in this directory.
Options +FollowSymLinks

# Customized error messages.
ErrorDocument 404 /index.php

# Set the default handler.
DirectoryIndex index.php

# force utf-8 for a number of file formats
AddCharset utf-8 .html .css .js .xml .json .rss

# Override PHP settings. More in sites/default/settings.php
# but the following cannot be changed at runtime.

# PHP 5, Apache 1 and 2.
<IfModule mod_php5.c>
  php_value magic_quotes_gpc                0
  php_value register_globals                0
  php_value session.auto_start              0
  php_value mbstring.http_input             pass
  php_value mbstring.http_output            pass
  php_value mbstring.encoding_translation   0
</IfModule>

# Requires mod_expires to be enabled.
<IfModule mod_expires.c>
  # Enable expirations.
  ExpiresActive On
  # Cache all files for 2 weeks after access (A).
  ExpiresDefault A1209600
  # Do not cache dynamically generated pages.
  ExpiresByType text/html A1
</IfModule>

# Various rewrite rules.
<IfModule mod_rewrite.c>
	RewriteEngine on

	RewriteRule "(^|/)\." - [F]

	RewriteRule ^css/(.*)\.[0-9]+\.css.php /css/$1.css.php [L]
	RewriteRule ^js/(.*)\.[0-9]+\.js.php /js/$1.js.php [L]

	# Rewrite current-style URLs of the form 'index.php?q=x'.
	RewriteCond %{REQUEST_URI} !=/server-status
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule ^(.*)$ index.php?croissant=$1 [L,QSA]

</IfModule>